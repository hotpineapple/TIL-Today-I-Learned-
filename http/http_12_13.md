# 12. 인증

- 수백만 명의 사람들이 웹을 통해 개인적인 업무를 보거나 개인적인 데이터에 접근함
- 허가된 사람만이 데이터에 접근하고 업무를 처리할 수 있어야 함
- 서버는 사용자가 누구인지 식별하여 어떤 작업이나 리소스에 접근할 수 있는지 결정해야 함

## 1. 인증 개요

- 인증이란 당신이 누구인지 증명하는 것
- HTTP의 인증 프레임워크
    - 자체 인증 요구/응답 프레임워크
    - 필요에 따라 고쳐쓸 수 있는 헤더를 통해 다른 인증 프로토콜에 맞추어 확장할 수 있는 프레임워크

### HTTP의 자체 인증 요구/응답

- HTTP 인증 모델
    - 클라이언트 → 서버: 리소스 요청
    - 서버 → 클라이언트: 인증 요구 응답
    - 클라이언트 → 서버: 인증 응답 + 리소스 요청
    - 서버 → 클라이언트: 리소스 응답

### 다른 인증 프로토콜을 이용하기 위한 헤더

- 인증 프로토콜
    - 기본 인증: 가장 잘 알려진 HTTP 인증 규약으로 거의 모든 주요 클라이언트와 서버에 구현되어 있음
    - 다이제스트 인증: 더욱 강력한 프로토콜
- **기본인증** 단계
    - 요청
    - WWW-Authenticate 헤더 + 401 Unauthorized
        - realm(보안영역) 에 대한 기술
    - Authorization 헤더 + 요청
        - Base-64로 인코딩한 사용자 이름과 비밀번호
        - 큰 따옴표, 콜론, 캐리지리턴과 같은 HTTP 헤더에서 사용할 수 없는 문자를 포함한 이름이나 비밀번호를 보내기에 유용함
    - Authentication-Info 헤더 + 200 OK

## 2. 기본 인증

### 프락시 인증

- 사용자들이 회사의 서버나 LAN, 무선 네트워크에 접근하기 전에 프락시 서버를 거치게 하여 사용자를 인증
- 프락시 서버에서 접근 정책을 중앙관리할 수 있기 때문에 회사 리소스 전체에 대한 통합적 접근 제어를 하기에 유용
- 웹 서버의 인증과 절차는 같으나 헤더와 상태코드가 약간 다름
    - 401 ~ 407
    - WWW-Authenticate ~ Proxy-Authenticate
    - Authorization ~ Proxy-Authorization
    - Authentication-Info ~ Proxy-Authentication-Info

### 기본 인증의 보안 결함

- 주로 악의적이지 않은 누군가가 의도치 않게 리소스에 접근하는 것을 막는 데 사용됨(접근하더라도 치명적이지 않은 경우)
- 더욱 강력한 보안을 위해서는 다이제스트 인증 혹은 SSL 과 혼용하여 사용해야 함

## 3. 다이제스트 인증

- 기본인증과 호환되는 더 안전한 대체재
- 널리 쓰이지는 않지만 이 개념은 보안 트랜잭션을 구현하는 데 유용함

### 다이제스트 인증의 특징

- 비밀번호를 절대로 네트워크를 통해 평문으로 전송하지 않음
- 인증 체결을 가로채서 재현하려는 악의적인 사람들을 차단함
- 구현하기에 따라서 메시지 내용 위조를 막는 것도 가능함
- 그 외 몇몇 잘 알려진 형태의 공격을 막을 수 있음

### 개선점

- 비밀 번호를 안전하게 지키기 위해 요약을 사용
    - 클라이언트는 비밀번호를 비가역적으로 뒤섞은 지문(fingerprint) 혹은 요약(digest)을 보냄
    - 클라이언트와 서버 모두 비밀번호를 알고 있으므로 서버는 클라이언트가 보낸 요약이 비밀번호에 알맞게 대응하는지 알 수 있음
    - 단방향 요약
        - 요약은 단방향 함수로 동작
        - 요약함수는 보통 암호 체크섬으로 불리며 단방향 해시함수이거나 지문함수임
- 재전송 방지를 위한 nonce 사용
    - 악당은 요약을 가로채서 몇 번이고 서버에 재전송 할 수 있음(요약은 비밀번호 그 자체)
    - 재전송 공격을 방지하기 위해 서버는 클라이언트에게 난스라고 불리는 자주 바뀌며 특별한 증표를 건네줌
    - 비밀번호의 요약은 특정한 난스 값에 대해서만 유효함
    - 난스는 WWW-Authenticate, Authentication-Info 헤더에 담겨서 전송됨

### 요약 계산

1. 보안 관련 데이터
    - 사용자 이름, 비밀번호, 보호 영역, 난스와 같은 정보
    - MD5, MD5-sess 를 이용하여 계산
2. 메시지 관련 데이터
    - URL, 요청 메서드, 메시지 본문과 같은정보
    - qop(quality of protection) 에 따라 두 가지의 방법으로 계산됨
        - auth(명시하지 않을 경우 기본값) : 요청 메서드와 URL만 포함
        - auth-int : 메시지 본문을 추가
    - +) qop 지시자가 존재하면 상호 인증을 반드시 수행해야 함(RFC 2069)
