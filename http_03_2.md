# Chapter 1. Basics - Unit 3. HTTP Messages - section 4 ~ 5 

## 4. 상태코드

### 4.1 100-199 : 정보성

- 100 : Continue
    - 요청의 시작 일부가 받아들여졌으며, 클라이언트는 나머지를 계속 이어서 보내야 함
    - 클라이언트가 서버에 엔터티 본문을 전송하기 전에 그 본문을 서버가 받아들일 것인지 확인하는 작업을 최적화
- 101 : Switch Protocols
    - 클라이언트가 Upgrade 헤더애 나열한 것 중 하나로 서버가 프로토콜을 바꾸었음

#### 클라이언트와 100 Continue

- 클라이언트가 서버에 요청 본문 엔터티를 보낼 것이라면 100-continue Expect 헤더를 보내야 하며, 그러지 않을 경우 보내지 않아야 한다(서버를 혼란에 빠뜨리지 않게 하기 위함)
- 100-continue Expect 헤더를 보낸 클라이언트는 막연히 응답을 기다려서는 안되며, 약간의 타임아웃 후에 그냥 엔터티를 보내야 한다.

#### 서버와 100 Continue

- 100-continue Expect 헤더를 받은 서버는 100 응답 혹은 에러코드로 답해야 한다.
- 100 응답을 보내기 전에 엔터티 일부 혹은 전체를 수신했다면 100 응답을 보낼 필요가 없고, 엔터티를 송신한 요청에 대한 응답을 보내면 된다.
- 에러등의 이유로 엔터티를 받지 않기로 결정한 경우 응답을 보낸 후 바로 연결을 닫아서는 안된다.

#### 프락시와 100 Continue

- 클라이언트로부터 100-continue 응답을 의도한 요청을 받은 프락시는
    - 다음 홉의 서버가 HTTP/1.1을 따르거나 잘 모르는 경우 - 이 헤더를 포함시켜서 전달
    - 다음 홉의 서버가 HTTP/1.1 을 따르지 않는 것을 나는 경우 - 417 Expectation Failed 에러 응답

### 4.2 200-299 : 성공

- 200 : OK
    - 요청 정상, 응답 엔터티 본문은 요청된 리소스를 포함하고 있음
- 201 : Created
    - 서버 개체를 생성하라는 요청(PUT)을 위함
    - 생성된 리소스에 대해 최대한 구체적인 참조가 담긴 location 헤더와 함께 그 리소스를 참조할 수 있는 여러 url을 본문에 포함해야 함
    - 이 상태코드를 보내기 전 반드시 객체를 생성해야 한다.
- 202 : Accepted
    - 요청은 받아들여졌으나 동작은 수행하지 않음
    - 요청이 처리될 것이라는 보장은 없음
    - 언제 처리될 것이라는 추정 혹은 그 정보를 어디서 얻을 수 있는지를 엔터티 본문에 포함할 것
- 203 : Non-authoritative Information
    - 엔터티 헤더에 들어있는 정보가 원래 서버가 아닌 리소스의 사본에서 옴
    - 중개자가 리소스의 사본을 갖고 있었지만 리소스에 대한 메타 정보를 검증하지 못한 경우
    - 필수는 아님
- 204 : No Content
    - 응답 메시지가 헤더와 상태줄을 포함하지만 엔터티 본문을 포함하지 않음
    - 주로 웹브라우저를 새 문서로 이동시키지 않고 갱신하고자 할 때 사용
- 205 : Reset Content
    - 브라우저에게 현재 페이지에 있는 HTML 폼에 채워진 모든 값을 비워라
- 206 : Partial Content
    - 부분 혹은 범위 요청이 성공함
    - Content-Range와 Date 헤더를 반드시 포함해야 함
    - Etag 와 Content-Location 중 하나의 헤더도 반드시 포함해야 함

### 4.3 300-399 : 리다이렉션

- 클라이언트가 관심있어하는 리소스에 대해 다른 위치를 사용하라고 말하거나 그 리소스의 내용 대신 다른 대안 응답을 제공함
- 만약 리소스가 옮겨졌다면 리소스가 옮겨졌으며 어디서 찾을 수 있는지 알리기 위해 상태코드와 Location 헤더를 사용할 수 있다.
- 또한 본문에 리다이렉트될 URL 링크와 설명을 포함시키는 것은 좋은 습관이다
- 300 : Multiple Choices
    - 클라이언트가 동시에 여러 리소스를 가리키는 URL을 요청한 경우
    - 그 리소스의 목록과 함께 반환
- 301 : Moved Permanently
    - 요청한 URL 이 옮겨졌을 때 사용
    - Location 헤더에 현재 리소스가 존재하는 URL을 포함해야 한다
- 302 : Found (for HTTP/1.0 클라이언트)
    - 301 상태코드와 같으나 클라이언트가 Location 헤더로 주어진 URL이 리소스를 **임시로** 가리키기 위한 목적으로 사용해야 함, **이후의 요청에서는 원래 URL을 사용해야 함**
- 303 : See Other
    - 리소스를 다른 URL에서 가져와야 함
    - 주로 POST 요청에 대한 응답
- 304 : Not Modified
    - 클라이언트는 헤더를 이용해 조건부 요청을 만들 수 있음
    - GET 요청을 보내며 최근에 리소스가 수정된 경우로 조건을 설정한 경우, 리소스가 수정되지 않았다면 이 상태코드를 응답
    - 엔터티 본문을 가지지 않음
- 305 : Use Proxy
    - **해당** 리소스가 반드시 프락시를 통해서 접근되어야 함
    - 프락시의 위치는 Location 헤더를 통해 주어짐
- 306 : 현재 사용되지 않음
- 307 : Temporary Redirect (for HTTP/1.1 클라이언트)
    - 301 상태코드와 비슷하나 클라이언트가 Location 헤더로 주어진 URL이 리소스를 **임시로** 가리키기 위한 목적으로 사용해야 함, **이후의 요청에서는 원래 URL을 사용해야 함**

### 4.4 400-499 : 클라이언트 에러

- 400 : Bad Request
    - 클라이언트가 잘못된 요청을 했을 때
- 401 : Unauthorized
    - 리소스를 얻기 전 클라이언트에게 스스로를 인증하라고 요구
- 402 : Payment Required
    - 현재 사용되지 않음
- 403 : Forbidden
    - 요청이 서버에 의해 거부되었음
- 404 : Not Found
    - 요청한 URL을 찾을 수 없는 경우
- 405 : Method Not Allowed
    - 지원하지 않는 메서드로 요청한 경우
- 406 : Not Acceptable
    - 요청한 리소스 중 클라이언트가 받아들일 수 있는 것(요청헤더에 있음)이 없는 경우
- 407 : Proxy Authentication Required
    - 401와 같으나 리소스에 대해 인증을 요구하는 프락시서버가 이용
- 408 : Request Timeout
    - 클라이언트의 요청을 완수하기에 시간이 너무 많이 걸리는 경우
- 409 : Conflict
    - 요청이 리소스에 대해 일으킬 수 있는 충돌을 지칭하기 위함
- 410 : Gone
    - 404와 비슷하나 서버가 한 때 그 리소스를 갖고 있었다는 점이 다름
- 411 : Length Required
    - 서버가 요청 메시지에 Content-Length 헤더가 있을 것을 요구할 때
- 412 : Precondition Failed
    - 조건부 요청을 했는데 그 중 하나가 실패했을 때
- 413 : Request Entity Too Large
    - 서버가 처리할 수 있는 한계를 넘은 크기의 요청을 보냈을 때
- 414 : Request Entity Too Long
    - 서버가 처리할 수 있는 한계를 넘은 길이의 요청 URL을 보냈을 때
- 415 : Unsupported Media Type
    - 서버가 이해하거나 지원하지 못하는 유형의 엔터티를 보냈을 때
- 416 : Requested Range Not Satisfiable
    - 요청한 리소스의 범위가 잘못되었을 때
- 417 : Expectation Failed
    - 요청 헤더에 서버가 만족시킬 수 있는 기대가 담긴 경우

### 4.5 500-599 : 서버 에러

- 500 : Internal Server Error
    - 서버가 요청을 처리할 수 없게 만드는 에러
- 501 : Not Implemented
    - 서버의 능력을 넘은 요청
- 502 : Bad Gateway
    - 프락시나 게이트웨이처럼 행동하는 서버가 그 요청/응답 연쇄에 있는 다음 링크로부터 가짜 응답에 맞닥뜨렸을 때
- 503 : Service Unavailable
    - 현재는 요청을 처리할 수 없지만 나중에는 가능함
    - Retry-After 헤더와 함께 사용 가능
- 504 : Gateway Timeout
    - 408과 비슷하지만 다른 서버에게 요청을 보내고 응답을 기다리다 타임아웃이 발생한 **게이트웨이나 프락시에서 온 응답**이라는 점이 다름
- 505 : HTTP Version Not Supported
    - 서버가 지원할 수 없거나 지원하지 않으려고 하는 버전의 프로토콜로 된 요청을 받았을 때 사용

## 5. 헤더

- 메서드와 함께 클라이언트와 서버가 무엇을 하는지 결정
- 종류
    - 일반 헤더
        - 클라이언트와 서버 모두 사용
        - 메시지가 만들어진 일시를 지칭하는 Date 헤더 등
    - 요청 헤더
        - 클라이언트가 받고자 하는 데이터의 타입이 무엇인지 지칭하는 Accept 헤더 등
    - 응답 헤더
        - 자신이 어떤 종류의 서버인지 지칭하는 Server 헤더 등
    - 엔터티 헤더
        - 엔터티 본문에 대한 정보
    - 확장 헤더
        - 명세에 없지만 애플리케이션 개발자들이 만든 헤더

### 5.1 일반 헤더

- Connection : 요청/응답 연결에 대한 옵션
- Date : 메시지가 언제 만들어졌는지 날짜와 시간
- MIME-Version : 발송자가 사용한 MIME의 버전
- Trailer chunked transfer : 인코딩된 메시지 끝부분에 위치한 헤더들의 목록
- Transfer-Encoding : 안전한 전송을 위해 어떤 인코딩이 적용되었는지
- Upgrade : 발송자가 업그레이드 하길 원하는 새 버전이나 프로토콜
- Via : 이 메시지가 어떤 중개자를 거쳐 왔는지

- 일반 캐시 헤더
    - 매 번 원 서버로부터 객체를 가져오는 대신 로컬 복사본으로 캐시할 수 있도록 하는 헤더
    - Cache-Control : 캐시 지시자
    - Pragma : deprecated

### 5.2 요청 헤더

- Client-IP : 클라이언트가 실행된 컴퓨터의 IP
- From : 클라이언트 사용자의 메일 주소
- Host : 요청 대상인 서버의 호스트명과 포트번호
- Referer : 현재 요청 URI가 들어있던 문서의 URL을 제공
- UA-Color : 클라이언트 기기 디스플레이의 색상 능력
- UA-CPU : 클라이언트 CPU의 종류나 제조사
- UA-Disp : 클라이언트 기기의 디스플레이 능력
- UA-OS : 클라이언트 기기에서 동작중인 운영체제 이름과 버전
- UA-Pixels : 클라이언트 기기 디스플레이에 대한 픽셀 정보
- USER-Agent : 요청을 보낸 애플리케이션의 이름

- Accept  관련 헤더
    - 클라이언트의 선호와 능력을 알림으로써 시간과 대역폭을 효율적으로 사용 가능
    - Accept : 미디어 종류
    - Accept-Charset : 문자집합
    - Accept-Encoding : 인코딩
    - Accept-Language : 언어
    - TE : 확장 전송 코딩

- 조건부 요청 헤더
    - 예를 들면 클라이언트가 어떤 문서의 사본을 갖고있는 상태라면, 서버에 현재 이 문서가 사본과 다를 때만 요청할 수 있다.
    - Expect : 요청에 필요한 서버의 행동을 열거
    - If-Match : 문서의 엔터티 태그가 주어진 엔터티 태그와 일치하는 경우
    - If-Modified-Since : 주어진 날짜 이후에 리소스가 변경된 경우
    - If-None-Match : 문서의 엔터티 태그가 주어진 엔터티 태그와 일치하지 않는 경우
    - If-Range : 문서의 특정 범위에 대한 요청
    - If-Unmodified-Since : 주어진 날짜 이후에 리소스가 변경되지 않은 경우
    - Range : 서버가 범위 요청을 지원하는 경우 문서의 특정 범위 요청
    
- 요청 보안 헤더
    - 트랜잭션을 안전하게 만들기 위해 클라이언트가 리소스에 접근하기 전 자신을 인증함
    - Authorization : 인증 그 자체
    - Cookie : 토큰을 전달할 때 사용
    - Cookie2 : 쿠키의 버전을 알림
    
- 프락시 요청 헤더
    - 프락시의 기능을 돕기 위함
    - Max-Forwards : 요청이 원 서버로 향하는 과정에서 다른 프락시나 게이트웨이로 전달될 수 있는 최대 횟수, TRACE 메서드와 함께 쓰임
    - Proxy-Authorization : 프락시에서 쓰이는 Authorization 헤더
    - Proxy-Connection :  프락시에서 쓰이는 Connection 헤더
    

### 5.3 응답 헤더

- Age : 응답이 얼마나 오래되었는지
- Public : 특정 리소스에 대해 지원하는 요청 메서드의 목록
- Retry-After : 현재 리소스가 사용불가능할 때 언제 사용 가능한지
- Server : 서버 애플리케이션의 이름과 버전
- Title : HTML 문서 제목
- Warning : 사유구절보다 자세한 경고 메시지

- 협상 헤더
    - 여러가지 표현이 가능한 HTML이 있는 경우 서버와 클라이언트가 선택할 수 있다
    - Accept-Ranges : 서버가 자원에 대해 받아들일 수 있는 범위의 형태
    - Vary : 서버가 확인해봐야 하고 응답에 영향을 줄 수 있는 헤더들의 목록
    
- 응답 보안 헤더
    - Proxy-Authenticate : 프락시에서 클라이언트로 보낸 인증요구 목록
    - Set-Cookie : 토큰 설정
    - Set-Cookie2  : 11장 참고
    - WWW-Authenticate : 서버에서 크라이언트로 보낸 인증요구 목록

### 5.4 엔터티 헤더

- 요청과 응답 모두 엔터티를 포함할 수 있기 때문에 양 타입의 메시지에 모두 나타날 수 있다
- Allow : 이 엔터티에 대해 수행될 수 있는 요청 메서드 나열
- Location : 엔터티가 실제로 어디에 위치하고 있는지

- 콘텐츠 헤더
    - Content-Base : 본문의 상대 URL을 계산하기 위한 베이스 URL
    - Content-Encoding : 본문에 적용된 인코딩
    - Content-Language : 본문을 이해하는데 적절한 자연어
    - Content-Length : 본문의 길이나 크기
    - Content-Location : 리소스가 실제로 어디에 위치하는지
    - Content-MD5 : 본문의 MD5 체크섬
    - Content-Range : 전체 리소스에서 이 엔터티가 해당한느 범위를 바이트 단위로 표현
    - Content-Type : 본문이 어떤 종류의 객체인지

- 엔티티 캐싱 헤더
    - 일반 캐싱 헤더 - 언제 어떻게 캐싱되어야 하는지
    - 엔티티 캐싱 헤더 - 엔터티 캐싱에 대한 정보
        - 캐시된 사본이 아직 유효한지
    - ETag : 엔터티에 대한 정보
    - Expires : 원본을 다시 받아와야 하는 일시
    - Last-Modified : 최근 이 엔터티가 변경된 일시
