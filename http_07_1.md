# Chapter 2. Architecture - Unit 7. Cache - section 1 ~ 6

- 자주 쓰이는 문서의 사본을 자동으로 보관하는 HTTP 장치
- 캐시의 혜택
    - 불필요한 데이터 전송을 줄여 네트워크 비용을 줄임
    - 네트워크 병목을 줄임
    - 원 서버 요청을 줄여 서버 부하를 줄이고 응답속도를  빠르게  한다
    - 거리로 인한 지연을 줄임

## 1. 불필요한 데이터 전송

- 복수의 클라이언트가 원서버의 한 페이지에 자주 접근할 때, 서버는 같은 문서를 클라이언트에게 각각 한 번 씩 전송
- 똑같은 바이트들이 네트워크를 통해 반복해서 이동
- 캐시를 이용하면 첫 번째 서버 응답은 캐시에 보관
- 캐시된 사본이 뒤이은 요청들에 대한 응답으로 사용
- 원서버가 중복해서 트래픽을 주고받는 낭비가 줄어듦

## 2. 대역폭 병목

- 많은 네트워크가 원격 서버보다 로컬 네트워크 클라이언트에 더 넓은 대역폭을 제공
- 클라이언트가 서버에 접근할 때의 속도는 그 경로에 있는 가장 느린 네트워크의 속도와 같음
- 원격서버가 아닌 속도가 빠른 LAN 에 있는 캐시로부터 사본을 가져온다면 캐싱은 성능을 대폭 개선할 수 있음

## 3. 갑작스런 요청 쇄도(Flash Crowds)

- 캐싱은 Flash Crowds에 대처하기 위해 특히 중요함
- 많은 사람이 거의 동시에 웹 문서에 접근할 때 발생
- 네트워크와 웹 서버에 심각한 장애를 야기시킨다.

## 4. 거리로 인한 지연

- 모든 네트워크 라우터는 제각각 인터넷 트래픽을 지연시킴
- 클라이언트와 서버 사이에 라우터가 그다지 많지 않다고 하더라도 빛의 속도 그 자체가 유의미한 지연을 유발함
- (병렬이면서 keep-alive 한 커넥션이라 할지라도 빛의 속도는 뚜렷한 지연을 발생시킴)

## 5. 적중(hit)과 부적중(miss)

- 캐시가 모든 문서의 사본을 저장하지는 않음
- 캐시에 요청이 도착했을 때. 그에 대응하는 사본이 있다면 그를 이용해 요청이 처리될 수 있다(캐시 적중)
- 만약 대응하는 사본이 없다면 원 서버로 전달되기만 할 뿐(캐시 부적중)

### 5.1 재검사(Revalidation)

- 웹 콘텐츠는 변경될 수 있기 때문에 캐시는 반드시 그들이 갖고 있는 사본이 여전히 최신인지 서버를 통해 점검해야 함
- HTTP 는 전체 객체를 가져오지 않고 빠르게 검사할 수 있는 특별한 요청을 정의
- 대부분의 캐시는 클라이언트가 사본을 요청하였으며 그 사본이 검사를 할 필요가 있을 정도로 충분히 오래된 경우에만 재검사를 함
- 캐시는 원서버에 작은 재검사 요청을 보내고, 콘첸츠가 변경되지 않았다면 서버는 아주 작은 304 Not Modified 응답을 보낸다 (재검사 적중 or 느린 적중)
- If-Modified-Since 헤더
    - GET 요청에 이를 추가하면 캐시된 시간 이후에 벼경된 경우에만 사본을 보내달라는 의미
    - 세 가지 상황
        - 재검사 적중 : 서버 콘텐츠가 변경되지 않은 경우
            - 304 Not Modified 응답
        - 재검사 부적중 : 서버 콘텐츠가 변경된 경우
            - 콘텐츠 전체와 함께 200 OK 응답
        - 객체가 삭제된 경우
            - 404 Not Found 응답
            - 캐시는 사본을 삭제함

### 5.2 적중률

- 캐시가 요청을 처리하는 비율
- 캐시 적중률 = 캐시 적중비 = 문서 적중률 = 문서 적중비
- 0 ~ 1 값 혹은 퍼센트
- 영향을 미치는 요인
    - 캐시가 얼마나 큰지
    - 사용자의 관심사가 얼마나 비슷한지
    - 캐시된 데이터가 얼마나 자주 변경되거나 개인화되는지
    - 캐시가 어떻게 설정되어 있는지
- 얼마나 많은 웹 트랜잭션이 외부로 내보내지 않았는지를 의미
- 트랜잭션이 필요로 하는 고정된 시간 (예-커넥션을 맺음)을 줄여 지연을 줄임

### 5.3 바이트 적중률

- 문서들의 크기가 다르기 때문에 적중률이 모든 것을 말해주지는 않음
- 큰 객체는 덜 접근되더라도 그 크기 때문에 전체 트래픽에는 더 크게 기여함
- 바이트 단위 적중률 측정값
    - 캐시를 통해 제공된 모든 바이트의 비율
    - 얼마나 많은 바이트가 인터넷으로 나가지 않았는지를 의미
    - 대역폭 절약을 최적화함

### 5.4 적중과 부적중의 구별

- 응답코드는 모두 200 OK 이므로 구별 불가능
- Date 헤더 또는 Age 헤더를 이용

## 6. 캐시 토폴로지

### 6.1 개인 전용 캐시

- 한 명의 사용자에게만 할당된 캐시
- 한 명의 사용자가 자주 찾는 페이지를 담음
- 작고 저렴할 수 있다
- 웹 브라우저는 개인 전용 캐시를 내장하고 있음
    - 개인용 컴퓨터의 디스크와 메모리에 캐시, 사용자가 캐시 사이즈 설정을 수정하는 것을  허용
    - 브라우저를 통해 캐시 콘텐츠를 볼 수 있음 (크롬 about:cache url)

### 6.2 공용 프락시 캐시

- 수 천명의 사용자들 간에 공유되는 캐시
- 사용자 집단에게 자주 쓰이는 페이지를 담음
- 공유된 프락시 서버 - 캐시 프락시 서버 혹은 **프락시 캐시**라고 불림
- 프락시를 위한 규칙을 따름
    - 수동 프락시를 지정하거나 프락시 자동설정 파일을 설정함으로써 브라우저가 프락시 캐시를 사용하도록 설정할 수 있다.
    - 또한 인터셉트 프락시를 사용함으로써 브라우저의 설정 없이 HTTP 요청이 캐시를 통하도록 강제할 수 있다

### 6.3 프락시 캐시 계층

- 작은 캐시에서 부적중이 발생했을 때 더 큰 부모캐시가 그 걸러 남겨진 트래픽을 처리하도록 하는 계층을 만드는 방식
- 클라이언트 주위에는 작고 저렴한 캐시를 사용하고, 계층 상단에는 크고 강력한 캐시를 사용
- 캐시 계층이 너무 깊으면 프락시 연쇄에 의해 프락시의 성능 저하가 있을 수 있다

### 6.4 캐시망, 콘텐츠라우팅, 피어링

- 캐시망 : 단순한 캐시 계층과 비교하여 더욱 복잡
- 캐시 커뮤니케이션 결정을 동적으로 내림
    - 어떤 부모 캐시와 대화할 것인지
    - 요청이 캐시를 완전히 우회해서 원 서버로 바로 가도록 할 것인지
- 콘텐츠 라우팅
    - 부모캐시와 원 서버 중 하나를 동적으로 선택
    - 특정 부모 캐시를 동적으로 선택
    - 부모캐시에게 가기 전에 캐시된 사본을 로컬에서 찾아본다
    - 다른 캐시들이 그들의 캐시된 콘텐츠에 부분적으로 접근할 수 있도록 허용하되, 그들의 캐시를 통한 인터넷 트랜짓은 허용하지 않음
- ICP(Internet Cache Protocol), HTCP(HyperText Cache Protocol)
    - HTTP 는 형제 캐시를 지원하지 않기 때문에 이를 사용하기 위해 HTTP 를 확장한 프로토콜
    - 형제 캐시 : 선택적인 피어링을 지원하는 캐시
        - 피어링 : 서로 다른 조직들이 상호 이득을 위해 그들의 캐시를 연결하여 서로를 찾아볼 수 있도록 하는 것
